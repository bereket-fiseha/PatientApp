{% extends "patient/base.html" %} {%block content%}

<!--Add and edit modal-->

<div
  class="modal fade"
  id="patient-create-update-modal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Patient</h5>
      </div>
      <div class="modal-body">
        <!--form start-->
        <form>
          {% csrf_token %}
          <div class="form-group mb-2">
            <label for="first_name">First Name:</label>
            <input type="text" class="form-control" id="first_name" />
          </div>
          <div class="form-group mb-2">
            <label for="last_name">Last Name:</label>
            <input type="text" class="form-control" id="last_name" />
          </div>
          <div class="form-group mb-2">
            <label for="date_of_birth">Date of Birth:</label>
            <input type="date" class="form-control" id="date_of_birth" />
          </div>
          <div class="form-group mb-2">
            <label for="phone_number">Phone Number:</label>
            <input type="text" class="form-control" id="phone_number" />
          </div>
          <div class="form-group mb-2">
            <label for="gender">Gender:</label>
            <select class="form-control select-dropdown" id="gender">
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
            </select>
          </div>
          <div class="form-group mb-2">
            <label for="email">Email address:</label>
            <input
              type="email"
              class="form-control"
              id="email"
              placeholder="Enter email"
            />
          </div>
          <div class="form-group mb-2">
            <label for="address">Address:</label>
            <input type="text" class="form-control" id="address" />
          </div>
        </form>
        <!--form end-->
      </div>
      <div class="modal-footer">
        <button
          type="button"
          onclick="closepatientModal()"
          class="btn btn-secondary"
          data-dismiss="modal"
        >
          Close
        </button>
        <button type="button" class="btn btn-primary" onclick="createpatient()">
          Save changes
        </button>
      </div>
    </div>
  </div>
</div>
<!--end Add and edit modal-->

<!--patient grid-->
<div class="row mb-4 mt-4">
  <div class="col-md-1"></div>

  <div class="col-md-8"><h2>Patients</h2></div>

  <div class="col-md-2"></div>
</div>


<div class="row">
  <div class="col-md-1"></div>


  <div class="col-md-10">
    <div class="card div-scrollable"style="overflow-y: scroll; height:550px;">
      <div class="card-header">
        <button class="btn" onclick="openPatientModalForCreate()">
          <i class="fa fa-plus-circle fa-2xl"></i>
        </button>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-12">
            <table id="example" class="table table-striped" style="width: 100%">
              <thead>
                <tr>
                  <th>Full Name</th>

                  <th>Gender</th>

                  <th>Email</th>
                  <th>Address</th>
                  <th>Age</th>
                  <th>Phone</th>
                     <th></th>
                                    <th></th>
                </tr>
              </thead>
              <tbody>
                {%for patient in patients%}
                <tr>
                  <td>{{patient.full_name}}</td>

                  <td>{{patient.gender}}</td>

                  <td>{{patient.email}}</td>
                  <td>{{patient.address}}</td>
                  <td>{{patient.age}}</td>
                  <td>{{patient.phone_number}}</td>
                  <td>
                    <button
                      class="btn mb-2"
                      onclick="openTodoModalForEdit({{todo.id}})"
                    >
                      <i class="fa fa-edit fa-lg" area-hidden="true"></i>
                    </button>
                  </td>
                  <td>
                    <button
                      class="btn"
                      onclick="deleteTodo({{todo.id}})"
                    >
                      <i class="fa fa-trash fa-lg" area-hidden="true"></i>
                    </button>
                  </td>

                  {%endfor%}
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-1"></div>
</div>
<!--end patient grid-->
{%endblock%} {%block jsscripts%}

<script>
  $(document).ready(function () {
    $("#example").DataTable({ pageLength: 5 });
  });
  function openPatientModalForCreate() {
    $("#patient-create-update-modal").modal("show");
  }
  function closepatientModal() {
    $("#patient-create-update-modal").modal("hide");
  }

  function createpatient() {
    $.ajax({
      url: "{%url 'patientapp:patient_create'%}",
      headers: {
        "X-CSRFToken": $("input[name=csrfmiddlewaretoken]").val(),
      },
      type: "POST",
      data: {
        first_name: $("#first_name").val(),
        last_name: $("#last_name").val(),
        date_of_birth: $("#date_of_birth").val(),
        phone_number: $("#phone_number").val(),
        email: $("#email").val(),
        gender: $("#gender").val(),

        address: $("#address").val(),
      },
      success: function (result) {
        console.log(result);
        if (result == "success") {
          toastr.success("Patient created successfully");
          setTimeout(() => {
            window.location.reload();
          }, "2500");
        }
      },
      error: function () {},
    });
  }

  function updatePatient() {
    $.ajax({
      url: "{%url 'patientapp:patient_update'%}",
      headers: {
        "X-CSRFToken": $("input[name=csrfmiddlewaretoken]").val(),
      },
      type: "POST",
      data: {
        first_name: $("#first_name").val(),
        last_name: $("#last_name").val(),
        date_of_birth: $("#date_of_birth").val(),
        phone_number: $("#phone_number").val(),
        email: $("#email").val(),
        gender: $("#gender").val(),

        address: $("#address").val(),
      },
      success: function (result) {
        console.log(result);
        if (result == "success") {
          toastr.success("Patient update successfully");
          setTimeout(() => {
            window.location.reload();
          }, "2500");
        }
      },
      error: function () {},
    });
  }
</script>
{%endblock%}
